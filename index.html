<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Three</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,sans-serif;background:linear-gradient(135deg,#0a0a0a,#1a1a1a);color:#fff;min-height:100vh;padding:2rem}
.container{max-width:480px;margin:0 auto}
.header{text-align:center;margin-bottom:2rem}
.title{font-size:1.5rem;font-weight:300;letter-spacing:.1em;opacity:.6;text-transform:uppercase}
.count{font-size:4rem;font-weight:200;margin:1rem 0;line-height:1}
.progress{height:2px;background:#333;border-radius:1px;overflow:hidden;margin:1rem auto;max-width:200px}
.bar{height:100%;background:linear-gradient(90deg,#fff,#888);width:0;transition:width .5s cubic-bezier(.4,0,.2,1)}
.task{padding:1rem;margin-bottom:1px;background:#222;cursor:pointer;display:flex;align-items:center;gap:1rem;transition:all .3s;border-left:3px solid transparent}
.task.done{background:#1a1a1a;border-left-color:#fff}
.check{width:20px;height:20px;border:1px solid #555;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px}
.task.done .check{background:#fff;color:#000}
.text{flex:1;font-weight:300;letter-spacing:.02em}
.task.done .text{opacity:.4;text-decoration:line-through}
.input-row{padding:1rem;background:#1a1a1a;display:flex;gap:1rem}
input{flex:1;background:transparent;border:none;color:#fff;font-size:1rem;outline:none}
input::placeholder{color:#666}
button{background:transparent;border:1px solid #333;color:#fff;width:40px;height:40px;border-radius:50%;cursor:pointer;font-size:1.2rem;transition:border-color .2s}
button:hover{border-color:#666}
.complete{margin-top:2rem;padding:1rem;background:#fff;color:#000;text-align:center;font-weight:300;letter-spacing:.05em}
.stats{margin-top:2rem;display:flex;gap:2rem;justify-content:center;opacity:.6;font-weight:300}
.stat{text-align:center}
.stat-num{font-size:1.2rem}
.stat-label{text-transform:uppercase;font-size:.7rem;letter-spacing:.05em}
.reset{margin-top:1rem;width:100%;padding:0.5rem;background:transparent;border:1px solid #333;color:#ccc;cursor:pointer;font-size:.8rem;text-transform:uppercase;border-radius:0}
.hidden{display:none!important}
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <div class="title">Three</div>
    <div class="count" id="count">0/3</div>
    <div class="progress"><div class="bar" id="bar"></div></div>
  </div>

  <div id="tasks"></div>

  <div class="input-row" id="input-row">
    <input id="input" placeholder="Add task">
    <button onclick="add()">+</button>
  </div>

  <div class="complete hidden" id="complete">DAY COMPLETE</div>

  <div class="stats">
    <div class="stat"><div class="stat-num" id="streak">0</div><div class="stat-label">Longest Streak</div></div>
    <div class="stat"><div class="stat-num" id="total">0</div><div class="stat-label">Total Completed</div></div>
  </div>

  <button class="reset" onclick="toggleView()">Toggle History</button>
  <button class="reset" onclick="printAnalytics()">Print Analytics</button>
  <button class="reset" onclick="resetDay()">Start New Day</button>
</div>

<script>
const getToday = () => new Date().toDateString();

let data = JSON.parse(
  localStorage.getItem("threeData") || '{"tasks":[],"date":"","streak":0,"total":0,"completed":false}'
);

if (data.date !== getToday()) {
  data.tasks.forEach(t => t.archived = true); // archive old tasks
  data.date = getToday();
  data.completed = false;
  save();
}

let showHistory = false;

function save() {
  localStorage.setItem("threeData", JSON.stringify(data));
}

function render() {
  const visibleTasks = showHistory ? data.tasks : data.tasks.filter(t => t.date === getToday());
  const done = visibleTasks.filter(t => t.done).length;
  const prog = visibleTasks.length ? (done / visibleTasks.length) * 100 : 0;

  document.getElementById("count").textContent = done + "/" + visibleTasks.length;
  document.getElementById("bar").style.width = prog + "%";

  document.getElementById("tasks").innerHTML = visibleTasks.map((t,i) =>
    `<div class="task ${t.done?'done':''}" onclick="toggle(${data.tasks.indexOf(t)})">
      <div class="check">${t.done?'✓':''}</div>
      <div class="text">${t.text}</div>
    </div>`
  ).join("");

  document.getElementById("input-row").className = showHistory ? "input-row hidden" : (visibleTasks.length<3?"input-row":"input-row hidden");
  document.getElementById("complete").className = done===3&&visibleTasks.length===3 ? "complete" : "complete hidden";
  document.getElementById("streak").textContent = data.streak;
  document.getElementById("total").textContent = data.total;

  if(done===3 && visibleTasks.length===3 && !data.completed){
    data.completed = true;
    data.streak++;
    data.total++;
    save();
  }
}

function add() {
  const val = document.getElementById("input").value.trim();
  if(val && data.tasks.filter(t=>t.date===getToday()).length<3){
    data.tasks.push({ text: val, done: false, date: getToday(), archived: false });
    document.getElementById("input").value = "";
    save();
    render();
  }
}

function toggle(i) {
  data.tasks[i].done = !data.tasks[i].done;
  save();
  render();
}

function resetDay() {
  if(confirm("Start a new day? This will clear your current tasks.")){
    data.tasks.forEach(t => { if(t.date===getToday()) t.archived=true; });
    data.completed=false;
    save();
    render();
  }
}

function toggleView(){
  showHistory = !showHistory;
  render();
}

function getAnalytics(){
  const days={};
  data.tasks.forEach(t=>{
    if(t.done) days[t.date]=(days[t.date]||0)+1;
  });
  const completedDays = Object.keys(days).length;
  const avg = completedDays ? (Object.values(days).reduce((a,b)=>a+b,0)/completedDays).toFixed(1) : 0;
  return { totalCompleted: data.total, longestStreak: data.streak, activeDays: completedDays, avgPerDay: avg };
}

function printAnalytics(){
  const a = getAnalytics();
  const w = window.open("");
  w.document.write(`
    <h2>Three – Analytics</h2>
    <p>Total Completed: ${a.totalCompleted}</p>
    <p>Active Days: ${a.activeDays}</p>
    <p>Avg Tasks / Day: ${a.avgPerDay}</p>
    <p>Longest Streak: ${a.longestStreak}</p>
  `);
  w.print();
}

document.getElementById("input").addEventListener("keydown", e => { if(e.key==="Enter") add(); });
render();
</script>
</body>
</html>
